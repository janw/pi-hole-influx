image: python:3.7
variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

stages:
  - test
  - build
  - tag

.tox:
  stage: test
  before_script:
    - pip install -U tox
  script:
    - tox -e ${CI_JOB_NAME}
  cache:
    key: pip-cache-$CI_JOB_NAME
    paths:
      - .cache/pip
      - .tox

py38:
  extends: .tox
  image: python:3.8

py39:
  extends: .tox
  image: python:3.9
  coverage: '/^(?:TOTAL|piholeinflux\.py).+?([\d\.]+\%)$/'

py310:
  extends: .tox
  image: python:3.10
